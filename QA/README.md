# envault QAツール

このディレクトリには、envaultのテストと品質保証に関連するツールとドキュメントが含まれています。

## 内容

- `manual_testing.md` - マニュアルテスト手順書
- `test_env_generator.sh` - テスト用の.envファイル生成スクリプト

## テスト方法

### 自動テスト

envaultには包括的な自動テストが実装されています。以下のコマンドで実行できます：

```bash
cd /path/to/envault
go test ./...
```

自動テストでは以下の機能がテストされます：

1. **暗号化機能**
   - AES-256-GCMによる暗号化の正確性
   - 暗号化されたデータの安全性（平文が含まれていないこと）
   - 同じデータを2回暗号化した結果が異なること（ソルトとnonceのランダム性）

2. **復号化機能**
   - 正しいパスワードでの復号化の成功
   - 間違ったパスワードでの復号化の失敗
   - 無効なデータの検出

3. **環境変数の解析**
   - 基本的な環境変数の解析
   - 空行とコメントの処理
   - 引用符付きの値の処理
   - 無効な形式の検出

4. **スクリプト生成**
   - エクスポートスクリプトの生成
   - アンセットスクリプトの生成
   - 特殊文字を含む値の適切なエスケープ

### マニュアルテスト

#### テスト用.envファイルの生成

テスト用の.envファイルを生成するには、以下のコマンドを実行します：

```bash
# デフォルト設定で.envファイルを生成
./test_env_generator.sh

# カスタム名と環境変数の数を指定
./test_env_generator.sh test.env 10
```

#### マニュアルテストの実行

`manual_testing.md`に記載されているテスト手順に従って、envaultの各機能をテストします。テスト結果は同ファイル内のテスト結果記録表に記入してください。

マニュアルテストでは以下の機能を検証します：

1. **暗号化機能**
   - 基本的な暗号化
   - 既存ファイルの上書き確認

2. **エクスポート機能**
   - 基本的なエクスポート
   - 誤ったパスワードでのエクスポート
   - stdinからのパスワード入力

3. **アンセット機能**
   - 基本的なアンセット
   - stdinからのパスワード入力

4. **ダンプ機能**
   - 基本的なダンプ（復号化した内容の表示）
   - カスタムファイルのダンプ
   - 出力のリダイレクト
   - stdinからのパスワード入力

5. **エラーケース**
   - 存在しないファイルの処理
   - 不正な形式のファイルの処理

## テスト環境の準備

1. envaultをビルドします：
   ```bash
   cd /path/to/envault
   go build -o envault cmd/envault/main.go
   ```

2. テスト用の.envファイルを生成します：
   ```bash
   ./QA/test_env_generator.sh
   ```

3. マニュアルテスト手順に従ってテストを実行します。

## セキュリティテスト

envaultのセキュリティ機能を検証するために、以下のテストを実施します：

1. **暗号化強度の検証**
   - 暗号化されたファイルに平文が含まれていないことを確認
   - 同じ内容を複数回暗号化した結果が異なることを確認（ソルトとnonceのランダム性）

2. **パスワード強度**
   - Argon2idによる安全なパスワード派生関数の使用
   - 弱いパスワードに対する警告（将来の機能）

3. **ファイルアクセス権限**
   - 暗号化されたファイルのパーミッションが適切に設定されていることを確認（0600）
